openapi: 3.0.3
info:
  title: Trellis API
  description: |
    Trellis is a development environment control plane that unifies local development,
    parallel branches, remote terminals, and live production logs.

    ## Versioning

    The API uses URL path versioning (`/api/v1/...`) for major versions. Within a major
    version, Stripe-style date-based versioning is supported via the `Trellis-Version`
    HTTP header (e.g., `Trellis-Version: 2026-01-17`).

    By default, the latest behavior is used. Pin to a specific date version for stability
    when breaking changes are introduced within a major version. The version date represents
    when a particular API behavior was current.

    ## Go Client Library

    An official Go client library is available at `github.com/wingedpig/trellis/pkg/client`.
    It provides typed access to all endpoints and supports API versioning. See the
    [documentation](/docs/reference/client/) for usage examples.
  version: 1.0.0
  contact:
    name: Trellis
    url: https://trellis.dev
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  - url: http://localhost:1234/api/v1
    description: Local development server

# Trellis is a local development tool with no authentication
security: []

tags:
  - name: Services
    description: Service lifecycle management
  - name: Worktrees
    description: Git worktree management
  - name: Workflows
    description: Workflow execution
  - name: Events
    description: Event history and real-time subscriptions
  - name: Logs
    description: Log viewer management
  - name: Trace
    description: Distributed tracing
  - name: Crashes
    description: Crash report management
  - name: Terminal
    description: Terminal session management
  - name: Navigation
    description: UI navigation options
  - name: Notify
    description: Notification events
  - name: Cases
    description: Case management for tracking units of work
  - name: Claude
    description: Claude Code session management and wrap-up
  - name: VSCode
    description: VS Code integration

paths:
  # ==================== SERVICES ====================
  /services:
    get:
      tags: [Services]
      summary: List all services
      operationId: listServices
      parameters:
        - $ref: '#/components/parameters/TrellisVersion'
      responses:
        '200':
          description: List of services
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ServiceInfo'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /services/{name}:
    get:
      tags: [Services]
      summary: Get service details
      operationId: getService
      parameters:
        - $ref: '#/components/parameters/ServiceName'
      responses:
        '200':
          description: Service details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ServiceInfo'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /services/{name}/start:
    post:
      tags: [Services]
      summary: Start a service
      operationId: startService
      parameters:
        - $ref: '#/components/parameters/ServiceName'
      responses:
        '200':
          description: Service started
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ServiceInfo'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  /services/{name}/stop:
    post:
      tags: [Services]
      summary: Stop a service
      operationId: stopService
      parameters:
        - $ref: '#/components/parameters/ServiceName'
      responses:
        '200':
          description: Service stopped
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ServiceInfo'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  /services/{name}/restart:
    post:
      tags: [Services]
      summary: Restart a service
      operationId: restartService
      parameters:
        - $ref: '#/components/parameters/ServiceName'
      responses:
        '200':
          description: Service restarted
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ServiceInfo'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  /services/{name}/logs:
    get:
      tags: [Services]
      summary: Get service logs
      operationId: getServiceLogs
      parameters:
        - $ref: '#/components/parameters/ServiceName'
        - name: lines
          in: query
          description: Number of log lines to return
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Service logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      service:
                        type: string
                      entries:
                        type: array
                        items:
                          $ref: '#/components/schemas/LogEntry'
                      lines:
                        type: array
                        items:
                          type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Services]
      summary: Clear service logs
      operationId: clearServiceLogs
      parameters:
        - $ref: '#/components/parameters/ServiceName'
      responses:
        '200':
          description: Logs cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      service:
                        type: string
                      cleared:
                        type: boolean
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /services/{name}/logs/stream:
    get:
      tags: [Services]
      summary: Stream service logs (SSE)
      operationId: streamServiceLogs
      parameters:
        - $ref: '#/components/parameters/ServiceName'
      responses:
        '200':
          description: Server-Sent Events stream
          content:
            text/event-stream:
              schema:
                type: string
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== WORKTREES ====================
  /worktrees:
    get:
      tags: [Worktrees]
      summary: List all worktrees
      operationId: listWorktrees
      parameters:
        - $ref: '#/components/parameters/TrellisVersion'
      responses:
        '200':
          description: List of worktrees
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      worktrees:
                        type: array
                        items:
                          $ref: '#/components/schemas/Worktree'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
    post:
      tags: [Worktrees]
      summary: Create a new worktree
      operationId: createWorktree
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [branch_name]
              properties:
                branch_name:
                  type: string
                  description: Branch name to create worktree from
                switch_to:
                  type: boolean
                  default: false
                  description: Whether to activate the new worktree
      responses:
        '201':
          description: Worktree created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      worktree:
                        $ref: '#/components/schemas/Worktree'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  /worktrees/info:
    get:
      tags: [Worktrees]
      summary: Get worktrees info with project metadata
      operationId: getWorktreesInfo
      responses:
        '200':
          description: Worktrees info
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      worktrees:
                        type: array
                        items:
                          $ref: '#/components/schemas/Worktree'
                      project_name:
                        type: string
                      binaries_dir:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /worktrees/{name}:
    get:
      tags: [Worktrees]
      summary: Get worktree details
      operationId: getWorktree
      parameters:
        - $ref: '#/components/parameters/WorktreeName'
      responses:
        '200':
          description: Worktree details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Worktree'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Worktrees]
      summary: Remove a worktree
      operationId: removeWorktree
      parameters:
        - $ref: '#/components/parameters/WorktreeName'
        - name: delete_branch
          in: query
          description: Whether to delete the associated branch
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Worktree removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      removed:
                        type: string
                      branch_deleted:
                        type: boolean
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  /worktrees/{name}/activate:
    post:
      tags: [Worktrees]
      summary: Activate a worktree
      operationId: activateWorktree
      parameters:
        - $ref: '#/components/parameters/WorktreeName'
      responses:
        '200':
          description: Worktree activated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      worktree:
                        $ref: '#/components/schemas/Worktree'
                      hook_results:
                        type: array
                        items:
                          $ref: '#/components/schemas/HookResult'
                      duration:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  # ==================== WORKFLOWS ====================
  /workflows:
    get:
      tags: [Workflows]
      summary: List all workflows
      operationId: listWorkflows
      parameters:
        - $ref: '#/components/parameters/TrellisVersion'
      responses:
        '200':
          description: List of workflows
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Workflow'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /workflows/{id}:
    get:
      tags: [Workflows]
      summary: Get workflow details
      operationId: getWorkflow
      parameters:
        - $ref: '#/components/parameters/WorkflowId'
      responses:
        '200':
          description: Workflow details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Workflow'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /workflows/{id}/run:
    post:
      tags: [Workflows]
      summary: Run a workflow
      operationId: runWorkflow
      parameters:
        - $ref: '#/components/parameters/WorkflowId'
        - name: worktree
          in: query
          description: Worktree to run workflow in
          schema:
            type: string
      requestBody:
        description: Workflow inputs
        content:
          application/json:
            schema:
              type: object
              properties:
                inputs:
                  type: object
                  additionalProperties: true
                  description: Input values keyed by input name
      responses:
        '200':
          description: Workflow execution result
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/WorkflowStatus'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  /workflows/{id}/status:
    get:
      tags: [Workflows]
      summary: Get workflow status
      operationId: getWorkflowStatus
      parameters:
        - $ref: '#/components/parameters/WorkflowId'
      responses:
        '200':
          description: Workflow status
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/WorkflowStatus'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /workflows/{runId}/stream:
    get:
      tags: [Workflows]
      summary: Stream workflow output (WebSocket)
      operationId: streamWorkflowOutput
      parameters:
        - name: runId
          in: path
          required: true
          description: Workflow run ID
          schema:
            type: string
      responses:
        '101':
          description: WebSocket upgrade
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== EVENTS ====================
  /events:
    get:
      tags: [Events]
      summary: Get event history
      operationId: getEvents
      parameters:
        - name: type
          in: query
          description: Event types to filter (supports wildcards)
          schema:
            type: array
            items:
              type: string
        - name: worktree
          in: query
          description: Filter by worktree name
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum events to return
          schema:
            type: integer
        - name: since
          in: query
          description: Events after this time
          schema:
            type: string
            format: date-time
        - name: until
          in: query
          description: Events before this time
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Event history
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /events/ws:
    get:
      tags: [Events]
      summary: Subscribe to events (WebSocket)
      operationId: subscribeEvents
      parameters:
        - name: pattern
          in: query
          description: Event pattern to subscribe to
          schema:
            type: string
            default: '*'
      responses:
        '101':
          description: WebSocket upgrade

  # ==================== NOTIFY ====================
  /notify:
    post:
      tags: [Notify]
      summary: Emit a notification event
      operationId: emitNotification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [message]
              properties:
                message:
                  type: string
                  description: Notification message
                type:
                  type: string
                  enum: [done, blocked, error]
                  default: done
                  description: Notification type
      responses:
        '200':
          description: Notification emitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      type:
                        type: string
                      timestamp:
                        type: string
                        format: date-time
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'

  # ==================== LOG VIEWERS ====================
  /logs:
    get:
      tags: [Logs]
      summary: List log viewers
      operationId: listLogViewers
      responses:
        '200':
          description: List of log viewers
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/LogViewerStatus'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /logs/{name}:
    get:
      tags: [Logs]
      summary: Get log viewer status
      operationId: getLogViewer
      parameters:
        - $ref: '#/components/parameters/LogViewerName'
      responses:
        '200':
          description: Log viewer status
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/LogViewerStatus'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /logs/{name}/entries:
    get:
      tags: [Logs]
      summary: Get log entries
      operationId: getLogEntries
      parameters:
        - $ref: '#/components/parameters/LogViewerName'
        - name: filter
          in: query
          description: Filter expression
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum entries to return
          schema:
            type: integer
            default: 1000
        - name: before
          in: query
          description: Only entries before this time
          schema:
            type: string
            format: date-time
        - name: after
          in: query
          description: Only entries after this time
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Log entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      entries:
                        type: array
                        items:
                          $ref: '#/components/schemas/LogEntry'
                      count:
                        type: integer
                      sequence:
                        type: integer
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /logs/{name}/history:
    get:
      tags: [Logs]
      summary: Get historical log entries
      operationId: getLogHistory
      parameters:
        - $ref: '#/components/parameters/LogViewerName'
        - name: start
          in: query
          required: true
          description: Start of time range
          schema:
            type: string
            format: date-time
        - name: end
          in: query
          required: true
          description: End of time range
          schema:
            type: string
            format: date-time
        - name: filter
          in: query
          description: Filter expression
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum entries
          schema:
            type: integer
            default: 10000
        - name: grep
          in: query
          description: Grep pattern for matching
          schema:
            type: string
        - name: before
          in: query
          description: Context lines before match
          schema:
            type: integer
        - name: after
          in: query
          description: Context lines after match
          schema:
            type: integer
      responses:
        '200':
          description: Historical log entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      entries:
                        type: array
                        items:
                          $ref: '#/components/schemas/LogEntry'
                      count:
                        type: integer
                      start:
                        type: string
                        format: date-time
                      end:
                        type: string
                        format: date-time
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /logs/{name}/files:
    get:
      tags: [Logs]
      summary: List rotated log files
      operationId: listLogFiles
      parameters:
        - $ref: '#/components/parameters/LogViewerName'
      responses:
        '200':
          description: List of log files
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        size:
                          type: integer
                        modified:
                          type: string
                          format: date-time
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /logs/{name}/stream:
    get:
      tags: [Logs]
      summary: Stream log entries (WebSocket)
      operationId: streamLogEntries
      parameters:
        - $ref: '#/components/parameters/LogViewerName'
        - name: filter
          in: query
          description: Initial filter expression
          schema:
            type: string
      responses:
        '101':
          description: WebSocket upgrade
        '404':
          $ref: '#/components/responses/NotFound'

  /logs/{name}/stream/sse:
    get:
      tags: [Logs]
      summary: Stream log entries (SSE)
      operationId: streamLogEntriesSSE
      parameters:
        - $ref: '#/components/parameters/LogViewerName'
      responses:
        '200':
          description: Server-Sent Events stream
          content:
            text/event-stream:
              schema:
                type: string
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== TRACE ====================
  /trace:
    post:
      tags: [Trace]
      summary: Execute a distributed trace search
      operationId: executeTrace
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id, group, start]
              properties:
                id:
                  type: string
                  description: Trace ID to search for
                group:
                  type: string
                  description: Trace group name
                start:
                  type: string
                  format: date-time
                  description: Start of time range
                end:
                  type: string
                  format: date-time
                  description: End of time range (default now)
                name:
                  type: string
                  description: Report name (auto-generated if empty)
                expand_by_id:
                  type: boolean
                  default: true
                  description: Whether to expand by ID
      responses:
        '200':
          description: Trace execution result
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      name:
                        type: string
                      status:
                        type: string
                        enum: [completed, failed]
                      total_entries:
                        type: integer
                      sources:
                        type: object
                        additionalProperties:
                          type: integer
                      duration_ms:
                        type: integer
                      error:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /trace/groups:
    get:
      tags: [Trace]
      summary: List trace groups
      operationId: listTraceGroups
      responses:
        '200':
          description: List of trace groups
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      groups:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            log_viewers:
                              type: array
                              items:
                                type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /trace/reports:
    get:
      tags: [Trace]
      summary: List trace reports
      operationId: listTraceReports
      responses:
        '200':
          description: List of trace reports
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      reports:
                        type: array
                        items:
                          $ref: '#/components/schemas/TraceReportSummary'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /trace/reports/{name}:
    get:
      tags: [Trace]
      summary: Get trace report
      operationId: getTraceReport
      parameters:
        - name: name
          in: path
          required: true
          description: Report name
          schema:
            type: string
      responses:
        '200':
          description: Trace report
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/TraceReport'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Trace]
      summary: Delete trace report
      operationId: deleteTraceReport
      parameters:
        - name: name
          in: path
          required: true
          description: Report name
          schema:
            type: string
      responses:
        '200':
          description: Report deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      deleted:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== CRASHES ====================
  /crashes:
    get:
      tags: [Crashes]
      summary: List all crashes
      operationId: listCrashes
      responses:
        '200':
          description: List of crashes
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CrashSummary'
    delete:
      tags: [Crashes]
      summary: Clear all crashes
      operationId: clearCrashes
      responses:
        '200':
          description: All crashes cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      message:
                        type: string

  /crashes/newest:
    get:
      tags: [Crashes]
      summary: Get most recent crash
      operationId: getNewestCrash
      responses:
        '200':
          description: Most recent crash
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Crash'

  /crashes/{id}:
    get:
      tags: [Crashes]
      summary: Get crash by ID
      operationId: getCrash
      parameters:
        - name: id
          in: path
          required: true
          description: Crash ID
          schema:
            type: string
      responses:
        '200':
          description: Crash details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Crash'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Crashes]
      summary: Delete crash
      operationId: deleteCrash
      parameters:
        - name: id
          in: path
          required: true
          description: Crash ID
          schema:
            type: string
      responses:
        '200':
          description: Crash deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      message:
                        type: string
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== TERMINAL ====================
  /terminal/sessions:
    get:
      tags: [Terminal]
      summary: List terminal sessions
      operationId: listTerminalSessions
      responses:
        '200':
          description: List of terminal sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      sessions:
                        type: array
                        items:
                          $ref: '#/components/schemas/TerminalSession'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  /terminal/ws:
    get:
      tags: [Terminal]
      summary: Terminal WebSocket connection
      operationId: terminalWebSocket
      parameters:
        - name: session
          in: query
          required: true
          description: Session name
          schema:
            type: string
        - name: window
          in: query
          required: true
          description: Window name
          schema:
            type: string
        - name: remote
          in: query
          description: Whether this is a remote connection
          schema:
            type: integer
            enum: [0, 1]
      responses:
        '101':
          description: WebSocket upgrade
        '400':
          $ref: '#/components/responses/BadRequest'

  /terminal/{worktree}/windows:
    post:
      tags: [Terminal]
      summary: Create a terminal window
      operationId: createTerminalWindow
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Window name (auto-generated if omitted)
                command:
                  type: string
                  description: Command to execute in the window
      responses:
        '200':
          description: Window created
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  session:
                    type: string
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /terminal/{worktree}/windows/{window}:
    patch:
      tags: [Terminal]
      summary: Rename a terminal window
      operationId: renameTerminalWindow
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - name: window
          in: path
          required: true
          description: Window name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  description: New window name
      responses:
        '204':
          description: Window renamed
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      tags: [Terminal]
      summary: Delete a terminal window
      operationId: deleteTerminalWindow
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - name: window
          in: path
          required: true
          description: Window name
          schema:
            type: string
      responses:
        '204':
          description: Window deleted
        '500':
          $ref: '#/components/responses/InternalError'

  # ==================== NAVIGATION ====================
  /nav/options:
    get:
      tags: [Navigation]
      summary: Get navigation options
      operationId: getNavOptions
      responses:
        '200':
          description: Navigation options
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/NavOptions'
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'

  # ==================== CASES ====================
  /cases/{worktree}:
    get:
      tags: [Cases]
      summary: List open cases
      operationId: listCases
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      responses:
        '200':
          description: List of open cases
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CaseInfo'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [Cases]
      summary: Create a case
      operationId: createCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title]
              properties:
                title:
                  type: string
                  description: Case title
                kind:
                  type: string
                  enum: [task, bug, feature, investigation]
                  default: task
                  description: Case kind
      responses:
        '201':
          description: Case created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/archived:
    get:
      tags: [Cases]
      summary: List archived cases
      operationId: listArchivedCases
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      responses:
        '200':
          description: List of archived cases
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CaseInfo'
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}:
    get:
      tags: [Cases]
      summary: Get case details
      operationId: getCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      responses:
        '200':
          description: Case details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Cases]
      summary: Update a case
      operationId: updateCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaseUpdate'
      responses:
        '204':
          description: Case updated
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Cases]
      summary: Delete a case
      operationId: deleteCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      responses:
        '204':
          description: Case deleted
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}/notes:
    get:
      tags: [Cases]
      summary: Get case notes
      operationId: getCaseNotes
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      responses:
        '200':
          description: Case notes as markdown
          content:
            text/markdown:
              schema:
                type: string
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}/archive:
    post:
      tags: [Cases]
      summary: Archive a case
      operationId: archiveCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      responses:
        '204':
          description: Case archived
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}/reopen:
    post:
      tags: [Cases]
      summary: Reopen an archived case
      operationId: reopenCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      responses:
        '204':
          description: Case reopened
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}/evidence:
    post:
      tags: [Cases]
      summary: Attach evidence file to a case
      operationId: attachEvidence
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: Evidence file to attach
                title:
                  type: string
                  description: Title (defaults to filename)
                tags:
                  type: array
                  items:
                    type: string
                  description: Tags for the evidence
      responses:
        '201':
          description: Evidence attached
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenceRef'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}/transcript:
    post:
      tags: [Cases]
      summary: Save a Claude transcript to a case
      operationId: saveTranscript
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [session_id]
              properties:
                session_id:
                  type: string
                  description: Claude session UUID
                title:
                  type: string
                  description: Transcript title (defaults to session display name)
      responses:
        '201':
          description: Transcript saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  claude_ref_id:
                    type: string
                    description: 8-character reference ID
                  title:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '503':
          description: Claude integration not configured

  /cases/{worktree}/{id}/transcript/{claude_id}:
    put:
      tags: [Cases]
      summary: Update a transcript with latest messages from its live session
      operationId: updateTranscript
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
        - name: claude_id
          in: path
          required: true
          description: Claude transcript reference ID
          schema:
            type: string
      responses:
        '200':
          description: Transcript updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  claude_ref_id:
                    type: string
                  message_count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'
        '503':
          description: Claude integration not configured

  /cases/{worktree}/{id}/transcript/{claude_id}/continue:
    post:
      tags: [Cases]
      summary: Continue a transcript in a new Claude session
      operationId: continueTranscript
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
        - name: claude_id
          in: path
          required: true
          description: Claude transcript reference ID
          schema:
            type: string
      responses:
        '201':
          description: New session created from transcript
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaudeSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '503':
          description: Claude integration not configured

  /cases/{worktree}/{id}/trace:
    post:
      tags: [Cases]
      summary: Save a trace report to a case
      operationId: saveCaseTrace
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [report_name]
              properties:
                report_name:
                  type: string
                  description: Name of trace report to save
      responses:
        '201':
          description: Trace saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  trace_ref_id:
                    type: string
                    description: 8-character reference ID
                  report_name:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /cases/{worktree}/{id}/trace/{trace_id}:
    delete:
      tags: [Cases]
      summary: Delete a saved trace from a case
      operationId: deleteCaseTrace
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - $ref: '#/components/parameters/CaseId'
        - name: trace_id
          in: path
          required: true
          description: Trace reference ID
          schema:
            type: string
      responses:
        '204':
          description: Trace deleted
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== CLAUDE ====================
  /claude/{worktree}/sessions:
    get:
      tags: [Claude]
      summary: List Claude sessions for a worktree
      operationId: listClaudeSessions
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ClaudeSession'
    post:
      tags: [Claude]
      summary: Create a new Claude session
      operationId: createClaudeSession
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                display_name:
                  type: string
                  description: Session display name (auto-generated if omitted)
      responses:
        '201':
          description: Session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaudeSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/{worktree}/sessions/import:
    post:
      tags: [Claude]
      summary: Import a transcript into a new session
      operationId: importClaudeSession
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaudeTranscript'
      responses:
        '201':
          description: Session created from transcript
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaudeSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/{worktree}/sessions/trash:
    get:
      tags: [Claude]
      summary: List trashed sessions for a worktree
      operationId: listTrashedClaudeSessions
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      responses:
        '200':
          description: List of trashed sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ClaudeSession'

  /claude/sessions/{session}:
    patch:
      tags: [Claude]
      summary: Rename a Claude session
      operationId: renameClaudeSession
      parameters:
        - $ref: '#/components/parameters/ClaudeSessionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [display_name]
              properties:
                display_name:
                  type: string
                  description: New display name
      responses:
        '204':
          description: Session renamed
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Claude]
      summary: Trash a Claude session
      operationId: trashClaudeSession
      parameters:
        - $ref: '#/components/parameters/ClaudeSessionId'
      responses:
        '204':
          description: Session trashed
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/sessions/{session}/ws:
    get:
      tags: [Claude]
      summary: Claude session WebSocket connection
      operationId: claudeSessionWebSocket
      parameters:
        - $ref: '#/components/parameters/ClaudeSessionId'
      responses:
        '101':
          description: WebSocket upgrade
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/sessions/{session}/export:
    get:
      tags: [Claude]
      summary: Export a Claude session transcript
      operationId: exportClaudeSession
      parameters:
        - $ref: '#/components/parameters/ClaudeSessionId'
        - name: level
          in: query
          description: Export detail level
          schema:
            type: string
            enum: [full, summary]
            default: full
      responses:
        '200':
          description: Exported transcript
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaudeTranscript'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/sessions/{session}/restore:
    post:
      tags: [Claude]
      summary: Restore a trashed session
      operationId: restoreClaudeSession
      parameters:
        - $ref: '#/components/parameters/ClaudeSessionId'
      responses:
        '204':
          description: Session restored
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/sessions/{session}/permanent:
    delete:
      tags: [Claude]
      summary: Permanently delete a trashed session
      operationId: permanentDeleteClaudeSession
      parameters:
        - $ref: '#/components/parameters/ClaudeSessionId'
      responses:
        '204':
          description: Session permanently deleted
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/{worktree}/ws:
    get:
      tags: [Claude]
      summary: Claude WebSocket by worktree (backwards compatibility)
      operationId: claudeWorktreeWebSocket
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      responses:
        '101':
          description: WebSocket upgrade
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/{worktree}/git-status:
    get:
      tags: [Claude]
      summary: Get git status for a worktree
      operationId: getClaudeGitStatus
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      responses:
        '200':
          description: Git status
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      clean:
                        type: boolean
                      modified:
                        type: array
                        items:
                          type: string
                      added:
                        type: array
                        items:
                          type: string
                      deleted:
                        type: array
                        items:
                          type: string
                      renamed:
                        type: array
                        items:
                          type: string
                      untracked:
                        type: array
                        items:
                          type: string
                      branch:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/{worktree}/session-case:
    get:
      tags: [Claude]
      summary: Check if a session is linked to an open case
      operationId: getClaudeSessionCase
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
        - name: session_id
          in: query
          required: true
          description: Claude session ID to look up
          schema:
            type: string
      responses:
        '200':
          description: Session is linked to an open case
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      case_id:
                        type: string
                      title:
                        type: string
                      kind:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '404':
          $ref: '#/components/responses/NotFound'

  /claude/{worktree}/wrap-up:
    post:
      tags: [Claude]
      summary: Wrap up a session  create/archive case and commit
      operationId: claudeWrapUp
      parameters:
        - $ref: '#/components/parameters/WorktreeParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - commit_message
              properties:
                session_id:
                  type: string
                  description: Claude session ID (for new case creation)
                case_id:
                  type: string
                  description: Existing case ID (mutually exclusive with title/kind)
                title:
                  type: string
                  description: New case title (required when case_id is not provided)
                kind:
                  type: string
                  description: New case kind (default task)
                  enum: [task, bug, feature, investigation]
                commit_message:
                  type: string
                  description: Git commit message (used as-is)
                files:
                  type: array
                  items:
                    type: string
                  description: Files to git add (relative to worktree root)
                links:
                  type: array
                  items:
                    type: object
                    properties:
                      title:
                        type: string
                      url:
                        type: string
                  description: Links to merge into the case
      responses:
        '200':
          description: Wrap-up completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      case_id:
                        type: string
                      commit_hash:
                        type: string
                  meta:
                    $ref: '#/components/schemas/ResponseMeta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ==================== VSCODE ====================
  /vscode/open:
    post:
      tags: [VSCode]
      summary: Open file in VS Code
      operationId: openInVSCode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - path
              properties:
                path:
                  type: string
                  description: File path to open
                line:
                  type: integer
                  description: Line number
                column:
                  type: integer
                  description: Column number
      responses:
        '200':
          description: File opened

components:
  parameters:
    TrellisVersion:
      name: Trellis-Version
      in: header
      required: false
      description: |
        API version date (e.g., 2026-01-17). This header can be sent with any API request.
        When omitted, the latest API behavior is used. Pin to a specific date for stability
        across API updates. The Go client library sets this automatically via WithVersion().
      schema:
        type: string
        pattern: '^\d{4}-\d{2}-\d{2}$'
        example: '2026-01-17'

    ServiceName:
      name: name
      in: path
      required: true
      description: Service name
      schema:
        type: string

    WorktreeName:
      name: name
      in: path
      required: true
      description: Worktree name
      schema:
        type: string

    WorkflowId:
      name: id
      in: path
      required: true
      description: Workflow ID
      schema:
        type: string

    LogViewerName:
      name: name
      in: path
      required: true
      description: Log viewer name
      schema:
        type: string

    WorktreeParam:
      name: worktree
      in: path
      required: true
      description: Worktree name
      schema:
        type: string

    CaseId:
      name: id
      in: path
      required: true
      description: "Case ID (e.g., 2026-02-19__fix-login-crash)"
      schema:
        type: string

    ClaudeSessionId:
      name: session
      in: path
      required: true
      description: Claude session UUID
      schema:
        type: string

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    ResponseMeta:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ServiceInfo:
      type: object
      properties:
        Name:
          type: string
        Status:
          $ref: '#/components/schemas/ServiceStatus'
        Enabled:
          type: boolean
        ParserType:
          type: string
        Layout:
          type: array
          items:
            type: object
        TimestampField:
          type: string
        LevelField:
          type: string
        MessageField:
          type: string

    ServiceStatus:
      type: object
      properties:
        State:
          type: string
          enum: [stopped, starting, running, stopping, crashed]
        PID:
          type: integer
        ExitCode:
          type: integer
        StartedAt:
          type: string
          format: date-time
        StoppedAt:
          type: string
          format: date-time
        RestartCount:
          type: integer
        Error:
          type: string

    Worktree:
      type: object
      properties:
        Path:
          type: string
        Branch:
          type: string
        Commit:
          type: string
        Detached:
          type: boolean
        IsBare:
          type: boolean
        Dirty:
          type: boolean
          description: Whether the worktree has uncommitted changes to tracked files. Untracked files are not considered dirty.
        Ahead:
          type: integer
        Behind:
          type: integer
        Active:
          type: boolean

    HookResult:
      type: object
      properties:
        name:
          type: string
        success:
          type: boolean
        output:
          type: string
        error:
          type: string
        duration:
          type: string

    Workflow:
      type: object
      properties:
        ID:
          type: string
        Name:
          type: string
        Description:
          type: string
          description: Description for CLI help and discoverability
        Command:
          type: array
          items:
            type: string
        Commands:
          type: array
          items:
            type: array
            items:
              type: string
        Timeout:
          type: integer
        OutputParser:
          type: string
        Confirm:
          type: boolean
        ConfirmMessage:
          type: string
        RequiresStopped:
          type: array
          items:
            type: string
        RestartServices:
          type: boolean
        Inputs:
          type: array
          description: Input parameters for this workflow
          items:
            $ref: '#/components/schemas/WorkflowInput'

    WorkflowInput:
      type: object
      description: Defines a parameter that can be passed when running a workflow
      properties:
        Name:
          type: string
          description: Variable name used in command templates
        Type:
          type: string
          enum: [text, select, checkbox, datepicker]
          description: Input type
        Label:
          type: string
          description: Human-readable display label
        Description:
          type: string
          description: Description for CLI help
        Placeholder:
          type: string
          description: Placeholder text for text inputs
        Options:
          type: array
          items:
            type: string
          description: Available choices for select inputs
        AllowedValues:
          type: array
          items:
            type: string
          description: Whitelist of allowed values for validation
        Pattern:
          type: string
          description: Regex pattern for validation
        Default:
          description: Default value
        Required:
          type: boolean
          description: Whether this input must be provided

    WorkflowStatus:
      type: object
      properties:
        ID:
          type: string
        Name:
          type: string
        State:
          type: string
          enum: [pending, running, success, failed, canceled]
        StartedAt:
          type: string
          format: date-time
        FinishedAt:
          type: string
          format: date-time
        Duration:
          type: integer
        Success:
          type: boolean
        ExitCode:
          type: integer
        Output:
          type: string
        OutputHTML:
          type: string
        ParsedLines:
          type: array
          items:
            $ref: '#/components/schemas/ParsedLine'
        Error:
          type: string

    ParsedLine:
      type: object
      properties:
        Type:
          type: string
          enum: [error, warning, test_pass, test_fail, test_skip]
        File:
          type: string
        Line:
          type: integer
        Column:
          type: integer
        Message:
          type: string
        Package:
          type: string
        TestName:
          type: string
        RawOutput:
          type: string
        StackTrace:
          type: array
          items:
            type: string

    Event:
      type: object
      properties:
        id:
          type: string
        version:
          type: string
        type:
          type: string
        timestamp:
          type: string
          format: date-time
        worktree:
          type: string
        payload:
          type: object

    LogViewerStatus:
      type: object
      properties:
        name:
          type: string
        connected:
          type: boolean
        entries:
          type: integer
        sequence:
          type: integer

    LogEntry:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        level:
          type: string
          enum: [trace, debug, info, warn, error, fatal]
        message:
          type: string
        fields:
          type: object
        raw:
          type: string
        source:
          type: string
        offset:
          type: integer
        sequence:
          type: integer

    TraceReportSummary:
      type: object
      properties:
        name:
          type: string
        trace_id:
          type: string
        group:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        entry_count:
          type: integer
        time_start:
          type: string
          format: date-time
        time_end:
          type: string
          format: date-time

    TraceReport:
      type: object
      properties:
        version:
          type: string
        name:
          type: string
        trace_id:
          type: string
        group:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        time_range:
          type: object
          properties:
            start:
              type: string
              format: date-time
            end:
              type: string
              format: date-time
        summary:
          type: object
          properties:
            total_entries:
              type: integer
            by_source:
              type: object
              additionalProperties:
                type: integer
            by_level:
              type: object
              additionalProperties:
                type: integer
            duration_ms:
              type: integer
        entries:
          type: array
          items:
            $ref: '#/components/schemas/TraceEntry'
        error:
          type: string

    TraceEntry:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        source:
          type: string
        level:
          type: string
        message:
          type: string
        fields:
          type: object
        raw:
          type: string
        is_context:
          type: boolean

    CrashSummary:
      type: object
      properties:
        id:
          type: string
        service:
          type: string
        timestamp:
          type: string
          format: date-time
        trace_id:
          type: string
        exit_code:
          type: integer
        error:
          type: string

    Crash:
      type: object
      properties:
        version:
          type: string
        id:
          type: string
        service:
          type: string
        timestamp:
          type: string
          format: date-time
        trace_id:
          type: string
        exit_code:
          type: integer
        error:
          type: string
        worktree:
          type: object
          properties:
            name:
              type: string
            branch:
              type: string
            path:
              type: string
        summary:
          type: object
          properties:
            total_entries:
              type: integer
            by_source:
              type: object
              additionalProperties:
                type: integer
            by_level:
              type: object
              additionalProperties:
                type: integer
        entries:
          type: array
          items:
            $ref: '#/components/schemas/CrashEntry'
        trigger:
          type: string

    CrashEntry:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        source:
          type: string
        level:
          type: string
        message:
          type: string
        fields:
          type: object
        raw:
          type: string

    TerminalSession:
      type: object
      properties:
        name:
          type: string
        worktree:
          type: string
        windows:
          type: array
          items:
            type: object
            properties:
              index:
                type: integer
              name:
                type: string
              active:
                type: boolean
        isRemote:
          type: boolean

    NavOptions:
      type: object
      properties:
        terminals:
          type: array
          items:
            type: object
            properties:
              url:
                type: string
              display:
                type: string
              isRemote:
                type: boolean
        services:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              status:
                type: string
        links:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              url:
                type: string
        logViewers:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
        shortcuts:
          type: array
          items:
            type: object
            properties:
              key:
                type: string
              window:
                type: string
        notifications:
          type: object
          properties:
            enabled:
              type: boolean
            events:
              type: array
              items:
                type: string
            failures_only:
              type: boolean
            sound:
              type: boolean

    CaseInfo:
      type: object
      description: Lightweight case summary for list views
      properties:
        id:
          type: string
          description: "Case ID (e.g., 2026-02-19__fix-login-crash)"
        title:
          type: string
        kind:
          type: string
          enum: [task, bug, feature, investigation]
        status:
          type: string
          enum: [open, resolved, wontfix]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        worktree:
          type: string

    Case:
      type: object
      description: Full case record
      properties:
        schema:
          type: string
          example: trellis.case.v1
        id:
          type: string
        title:
          type: string
        kind:
          type: string
          enum: [task, bug, feature, investigation]
        status:
          type: string
          enum: [open, resolved, wontfix]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        worktree:
          type: object
          properties:
            name:
              type: string
            branch:
              type: string
            base_commit:
              type: string
        links:
          type: array
          items:
            $ref: '#/components/schemas/CaseLink'
        evidence:
          type: array
          items:
            $ref: '#/components/schemas/EvidenceRef'
        claude:
          type: array
          items:
            $ref: '#/components/schemas/ClaudeRef'

    CaseUpdate:
      type: object
      description: Fields to update on a case (all optional)
      properties:
        title:
          type: string
        kind:
          type: string
          enum: [task, bug, feature, investigation]
        status:
          type: string
          enum: [open, resolved, wontfix]
        links:
          type: array
          description: Full array replaces existing links
          items:
            $ref: '#/components/schemas/CaseLink'
        notes:
          type: string
          description: Overwrites notes.md content

    CaseLink:
      type: object
      properties:
        title:
          type: string
        url:
          type: string

    EvidenceRef:
      type: object
      properties:
        title:
          type: string
        filename:
          type: string
        format:
          type: string
          description: File extension without dot
        tags:
          type: array
          items:
            type: string
        added_at:
          type: string
          format: date-time

    ClaudeRef:
      type: object
      description: Reference to a Claude transcript saved in a case
      properties:
        id:
          type: string
          description: 8-character reference ID
        title:
          type: string
        filename:
          type: string
        exported_at:
          type: string
          format: date-time
        message_count:
          type: integer
        preview:
          type: string
          description: First 200 characters of first user message
        source_session_id:
          type: string
          description: Original session UUID if linked to a live session

    ClaudeSession:
      type: object
      properties:
        id:
          type: string
          description: Session UUID
        worktree_name:
          type: string
        display_name:
          type: string
        last_user_input:
          type: string
          format: date-time
          description: Time of last user message (null if none)
        created_at:
          type: string
          format: date-time
        trashed_at:
          type: string
          format: date-time
          description: Null if not trashed

    ClaudeTranscript:
      type: object
      description: Exported Claude session transcript
      properties:
        schema:
          type: string
        exported_at:
          type: string
          format: date-time
        source:
          type: object
          properties:
            trellis_session_id:
              type: string
            claude_session_id:
              type: string
            worktree:
              type: string
            branch:
              type: string
            display_name:
              type: string
            project_path:
              type: string
            created_at:
              type: string
              format: date-time
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ClaudeMessage'
        stats:
          type: object
          properties:
            message_count:
              type: integer
            user_turns:
              type: integer
            assistant_turns:
              type: integer
            tool_uses:
              type: integer

    ClaudeMessage:
      type: object
      properties:
        role:
          type: string
          enum: [user, assistant]
        content:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [text, tool_use, tool_result, image, image_diff]
              text:
                type: string
              id:
                type: string
              name:
                type: string
              input:
                type: object
              tool_use_id:
                type: string
              content:
                type: string
        timestamp:
          type: string
          format: date-time
